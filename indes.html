<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Cairo', sans-serif;
        }
        /* Ø¥Ø®ÙØ§Ø¡ Ø±Ø§Ø¯ÙŠÙˆ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø£ØµÙ„ÙŠ */
        .choice-input {
            display: none;
        }
        /* ØªØµÙ…ÙŠÙ… Ø§Ù„ÙƒØ§Ø±Øª Ù„Ù„Ø§Ø®ØªÙŠØ§Ø± */
        .choice-card {
            transition: all 0.2s ease-in-out;
            cursor: pointer;
            border: 2px solid #e5e7eb; /* gray-200 */
            background-color: #f9fafb; /* gray-50 */
        }
        /* ØªØºÙŠÙŠØ± Ø´ÙƒÙ„ Ø§Ù„ÙƒØ§Ø±Øª Ø¹Ù†Ø¯ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø±Ø§Ø¯ÙŠÙˆ Ø§Ù„Ø°ÙŠ Ø¨Ø¯Ø§Ø®Ù„Ù‡ */
        .choice-input:checked + .choice-card {
            border-color: #2563eb; /* blue-600 */
            background-color: #eff6ff; /* blue-50 */
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        #printer-type-section.hidden {
            max-height: 0;
            overflow: hidden;
            padding-top: 0;
            padding-bottom: 0;
            margin-top: 0;
            opacity: 0;
        }
        #printer-type-section {
            transition: all 0.4s ease-in-out;
            max-height: 500px;
            opacity: 1;
        }
        /* Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¹Ù†Ø§ØµØ± ØºÙŠØ± Ø§Ù„Ù…Ø±ØºÙˆØ¨ ÙÙŠÙ‡Ø§ Ø¹Ù†Ø¯ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© */
        @media print {
            body * {
                visibility: hidden;
            }
            #invoice-container, #invoice-container * {
                visibility: visible;
            }
            #invoice-container {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                margin: 0;
                padding: 1rem;
                border: none;
                box-shadow: none;
            }
            .no-print {
                display: none !important;
            }
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <!-- Modal for Custom Alerts -->
    <div id="custom-alert-modal" class="fixed inset-0 bg-black bg-opacity-60 z-50 flex justify-center items-center hidden transition-opacity duration-300 opacity-0">
        <div class="bg-white rounded-2xl shadow-xl p-6 md:p-8 w-11/12 md:w-1/3 text-center transform scale-95 transition-transform duration-300">
            <p id="alert-message" class="text-lg mb-6"></p>
            <button id="alert-close-btn" class="bg-blue-600 text-white font-bold py-2 px-8 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-300">
                Ù…ÙˆØ§ÙÙ‚
            </button>
        </div>
    </div>

    <div class="container mx-auto p-4 md:p-8">
        
        <header class="text-center mb-8 no-print">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-800">Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©</h1>
        </header>
        
        <div class="bg-white p-6 md:p-8 rounded-2xl shadow-lg max-w-4xl mx-auto no-print">
            <form id="pricing-form">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                    <div>
                        <label for="pages" class="block text-lg font-medium text-gray-700 mb-2">Ø¹Ø¯Ø¯ Ø§Ù„ØµÙØ­Ø§Øª</label>
                        <input type="number" id="pages" name="pages" min="1" class="w-full p-3 bg-gray-50 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" placeholder="Ù…Ø«Ø§Ù„: 50" required>
                    </div>
                    <div>
                        <label for="customer-phone" class="block text-lg font-medium text-gray-700 mb-2">Ø±Ù‚Ù… Ù‡Ø§ØªÙ Ø§Ù„Ø¹Ù…ÙŠÙ„</label>
                        <input type="tel" id="customer-phone" name="customer-phone" class="w-full p-3 bg-gray-50 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" placeholder="Ø§Ø®ØªÙŠØ§Ø±ÙŠ">
                    </div>
                </div>

                <div class="space-y-8">
                    <!-- Ù†ÙˆØ¹ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© -->
                    <div>
                        <h3 class="text-lg font-medium text-gray-700 mb-4">Ù†ÙˆØ¹ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©</h3>
                        <div class="grid grid-cols-2 gap-4">
                            <label>
                                <input type="radio" name="color-type" value="bw" class="choice-input" checked>
                                <div class="choice-card p-4 rounded-lg text-center">
                                    <span class="text-3xl">âš«ï¸</span>
                                    <p class="font-semibold mt-2">Ø£Ø¨ÙŠØ¶ ÙˆØ£Ø³ÙˆØ¯</p>
                                </div>
                            </label>
                            <label>
                                <input type="radio" name="color-type" value="color" class="choice-input">
                                <div class="choice-card p-4 rounded-lg text-center">
                                    <span class="text-3xl">ğŸ¨</span>
                                    <p class="font-semibold mt-2">Ø£Ù„ÙˆØ§Ù†</p>
                                </div>
                            </label>
                        </div>
                    </div>

                    <!-- ÙˆØ¬Ù‡ ÙˆØ¸Ù‡Ø± -->
                    <div>
                        <h3 class="text-lg font-medium text-gray-700 mb-4">ÙˆØ¬Ù‡ ÙˆØ¸Ù‡Ø±</h3>
                        <div class="grid grid-cols-2 gap-4">
                            <label>
                                <input type="radio" name="sided-type" value="single" class="choice-input" checked>
                                <div class="choice-card p-4 rounded-lg text-center">
                                    <span class="text-3xl">ğŸ“„</span>
                                    <p class="font-semibold mt-2">ÙˆØ¬Ù‡ ÙˆØ§Ø­Ø¯</p>
                                </div>
                            </label>
                            <label>
                                <input type="radio" name="sided-type" value="double" class="choice-input">
                                <div class="choice-card p-4 rounded-lg text-center">
                                    <span class="text-3xl">ğŸ“‘</span>
                                    <p class="font-semibold mt-2">ÙˆØ¬Ù‡ ÙˆØ¸Ù‡Ø±</p>
                                </div>
                            </label>
                        </div>
                    </div>

                    <!-- **NEW**: Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ -->
                    <div>
                        <h3 class="text-lg font-medium text-gray-700 mb-4">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</h3>
                        <div class="grid grid-cols-2 gap-4">
                            <label>
                                <input type="radio" name="payment-method" value="cash" class="choice-input" checked>
                                <div class="choice-card p-4 rounded-lg text-center">
                                    <span class="text-3xl">ğŸ’µ</span>
                                    <p class="font-semibold mt-2">Ù†Ù‚Ø¯ÙŠ</p>
                                </div>
                            </label>
                            <label>
                                <input type="radio" name="payment-method" value="visa" class="choice-input">
                                <div class="choice-card p-4 rounded-lg text-center">
                                    <span class="text-3xl">ğŸ’³</span>
                                    <p class="font-semibold mt-2">ÙÙŠØ²Ø§</p>
                                </div>
                            </label>
                        </div>
                    </div>
                </div>
                
                <!-- Ù†ÙˆØ¹ Ø§Ù„Ø·Ø§Ø¨Ø¹Ø© (ÙŠØ¸Ù‡Ø± Ø¹Ù†Ø¯ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø£Ù„ÙˆØ§Ù†) -->
                <div id="printer-type-section" class="mt-8 pt-8 border-t border-gray-200 hidden">
                    <h3 class="text-lg font-medium text-gray-700 mb-4">Ù†ÙˆØ¹ Ø·Ø§Ø¨Ø¹Ø© Ø§Ù„Ø£Ù„ÙˆØ§Ù†</h3>
                    <div class="grid grid-cols-2 gap-4">
                        <label>
                            <input type="radio" name="printer-type" value="inkjet" class="choice-input" checked>
                            <div class="choice-card p-4 rounded-lg text-center">
                                <span class="text-3xl">ğŸ’§</span>
                                <p class="font-semibold mt-2">Ø¥Ù†Ùƒ Ø¬ÙŠØª (Inkjet)</p>
                            </div>
                        </label>
                        <label>
                            <input type="radio" name="printer-type" value="laser" class="choice-input">
                            <div class="choice-card p-4 rounded-lg text-center">
                                <span class="text-3xl">âš¡ï¸</span>
                                <p class="font-semibold mt-2">Ù„ÙŠØ²Ø± (Laser)</p>
                            </div>
                        </label>
                    </div>
                </div>
                
                <!-- Ø²Ø± Ø§Ù„Ø­Ø³Ø§Ø¨ ÙˆØ§Ù„Ø­ÙØ¸ -->
                <div class="mt-10 pt-10 border-t border-gray-200 text-center">
                    <button type="submit" id="calculate-btn" class="bg-blue-600 text-white font-bold py-3 px-12 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-300 transition-all transform hover:scale-105 shadow-lg">
                        Ø­Ø³Ø§Ø¨ Ø§Ù„ØªÙƒÙ„ÙØ© ÙˆØ­ÙØ¸ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©
                    </button>
                </div>
            </form>
        </div>

        <!-- Ù‚Ø³Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø© -->
        <div id="invoice-wrapper" class="max-w-4xl mx-auto mt-8 hidden">
             <div id="invoice-container" class="bg-white p-8 rounded-2xl shadow-lg border border-gray-200">
                 <header class="flex justify-between items-start pb-6 border-b-2 border-gray-100">
                    <div>
                        <img src="https://i.ibb.co/6y4G1z3/logo-1.jpg" alt="Ø´Ø¹Ø§Ø± Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø±Ø¶ÙˆÙ‰" class="h-20 w-auto" onerror="this.style.display='none'">
                    </div>
                    <div class="text-left">
                        <h1 class="text-4xl font-bold text-blue-600">ÙØ§ØªÙˆØ±Ø©</h1>
                        <p id="invoice-number" class="text-gray-500"></p>
                    </div>
                </header>
                <section class="mt-8 grid grid-cols-2 gap-8">
                    <div>
                        <h3 class="text-lg font-semibold text-gray-700">ÙØ§ØªÙˆØ±Ø© Ø¥Ù„Ù‰:</h3>
                        <p id="invoice-customer-phone" class="text-gray-600">ØºÙŠØ± Ù…Ø­Ø¯Ø¯</p>
                    </div>
                    <div class="text-left">
                        <h3 class="text-lg font-semibold text-gray-700">ØªØ§Ø±ÙŠØ® Ø§Ù„ÙØ§ØªÙˆØ±Ø©:</h3>
                        <p id="invoice-date" class="text-gray-600"></p>
                        <!-- **NEW**: Display payment method -->
                        <h3 class="text-lg font-semibold text-gray-700 mt-2">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹:</h3>
                        <p id="invoice-payment-method" class="text-gray-600"></p>
                    </div>
                </section>
                <section class="mt-10">
                    <table class="w-full text-right">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="p-3 text-sm font-semibold tracking-wide text-right rounded-r-lg">Ø§Ù„ÙˆØµÙ</th>
                                <th class="p-3 text-sm font-semibold tracking-wide text-center">Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                                <th class="p-3 text-sm font-semibold tracking-wide text-center">Ø³Ø¹Ø± Ø§Ù„ÙˆØ­Ø¯Ø©</th>
                                <th class="p-3 text-sm font-semibold tracking-wide text-left rounded-l-lg">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
                            </tr>
                        </thead>
                        <tbody id="invoice-items">
                        </tbody>
                    </table>
                </section>
                <section class="mt-8 flex justify-end">
                    <div class="w-full md:w-2/5">
                        <div class="bg-gray-50 rounded-lg p-4">
                            <div class="flex justify-between py-2">
                                <span class="font-semibold text-gray-600">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØ±Ø¹ÙŠ</span>
                                <span id="invoice-subtotal" class="font-semibold text-gray-800"></span>
                            </div>
                             <div class="flex justify-between py-2 border-t-2 border-dashed border-gray-200 mt-2">
                                <span class="font-bold text-xl text-gray-800">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</span>
                                <span id="invoice-total" class="font-bold text-xl text-blue-600"></span>
                            </div>
                        </div>
                    </div>
                </section>
                <footer class="mt-12 pt-6 border-t border-gray-200 text-center text-gray-500 text-sm">
                    <p>Ø´ÙƒØ±Ø§Ù‹ Ù„ØªØ¹Ø§Ù…Ù„ÙƒÙ… Ù…Ø¹ Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø±Ø¶ÙˆÙ‰!</p>
                </footer>
            </div>
            <div class="mt-6 text-center no-print">
                <button id="print-btn" class="bg-green-600 text-white font-bold py-3 px-12 rounded-lg hover:bg-green-700 focus:outline-none focus:ring-4 focus:ring-green-300 transition-all transform hover:scale-105">
                    ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©
                </button>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- Custom Alert Logic ---
        const alertModal = document.getElementById('custom-alert-modal');
        const alertMessage = document.getElementById('alert-message');
        const alertCloseBtn = document.getElementById('alert-close-btn');

        function showAlert(message) {
            alertMessage.textContent = message;
            alertModal.classList.remove('hidden');
            setTimeout(() => {
                alertModal.classList.remove('opacity-0');
                alertModal.querySelector('div').classList.remove('scale-95');
            }, 10);
        }

        alertCloseBtn.addEventListener('click', () => {
            alertModal.classList.add('opacity-0');
            alertModal.querySelector('div').classList.add('scale-95');
            setTimeout(() => alertModal.classList.add('hidden'), 300);
        });

        // --- App Logic ---
        const prices = {
            bw: { single: 1.00, double: 1.50 },
            color: {
                inkjet: { single: 3.00, double: 5.00 },
                laser: { single: 5.00, double: 8.00 }
            }
        };

        const form = document.getElementById('pricing-form');
        const colorTypeRadios = document.querySelectorAll('input[name="color-type"]');
        const printerTypeSection = document.getElementById('printer-type-section');
        const calculateBtn = document.getElementById('calculate-btn');

        // Show/hide printer type section based on color selection
        colorTypeRadios.forEach(radio => {
            radio.addEventListener('change', (event) => {
                if (event.target.value === 'color') {
                    printerTypeSection.classList.remove('hidden');
                } else {
                    printerTypeSection.classList.add('hidden');
                }
            });
        });
        
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const pagesInput = document.getElementById('pages');
            const pages = parseInt(pagesInput.value);
            if (!pages || pages < 1) {
                showAlert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø¹Ø¯Ø¯ ØµØ­ÙŠØ­ Ù„Ù„ØµÙØ­Ø§Øª.');
                return;
            }

            const formData = new FormData(form);
            const colorType = formData.get('color-type');
            const sidedType = formData.get('sided-type');
            const paymentMethod = formData.get('payment-method');
            
            let pricePerSheet = 0;
            let description = "";
            const colorText = colorType === 'bw' ? 'Ø£Ø¨ÙŠØ¶ ÙˆØ£Ø³ÙˆØ¯' : 'Ø£Ù„ÙˆØ§Ù†';
            const sidedText = sidedType === 'single' ? 'ÙˆØ¬Ù‡ ÙˆØ§Ø­Ø¯' : 'ÙˆØ¬Ù‡ ÙˆØ¸Ù‡Ø±';
            const paymentText = paymentMethod === 'cash' ? 'Ù†Ù‚Ø¯ÙŠ' : 'ÙÙŠØ²Ø§';

            if (colorType === 'bw') {
                pricePerSheet = prices.bw[sidedType];
                description = `Ø·Ø¨Ø§Ø¹Ø© ${colorText} - ${sidedText}`;
            } else {
                const printerType = formData.get('printer-type');
                if (!printerType) {
                    showAlert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø·Ø§Ø¨Ø¹Ø© Ø§Ù„Ø£Ù„ÙˆØ§Ù†.');
                    return;
                }
                const printerText = printerType === 'inkjet' ? 'Ø¥Ù†Ùƒ Ø¬ÙŠØª' : 'Ù„ÙŠØ²Ø±';
                pricePerSheet = prices.color[printerType][sidedType];
                description = `Ø·Ø¨Ø§Ø¹Ø© ${colorText} (${printerText}) - ${sidedText}`;
            }
            
            const totalCost = pages * pricePerSheet;

            // Populate the invoice
            populateInvoice(pages, description, pricePerSheet, totalCost, paymentText);
            
            // Save to Google Sheets
            calculateBtn.disabled = true;
            calculateBtn.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...';
            
            try {
                // Create the data object
                const data = {
                    timestamp: new Date().toLocaleString('ar-EG'),
                    customerPhone: document.getElementById('customer-phone').value || 'Ø¹Ù…ÙŠÙ„ Ù†Ù‚Ø¯ÙŠ',
                    description: description,
                    quantity: pages,
                    totalCost: totalCost.toFixed(2),
                    paymentMethod: paymentText
                };

                // Convert data to URL-encoded string
                const formBody = Object.keys(data)
                    .map(key => encodeURIComponent(key) + '=' + encodeURIComponent(data[key]))
                    .join('&');

                // Send the data to Google Sheets
                const response = await fetch('https://script.google.com/macros/s/AKfycbyCgStz1OTQVUCOv6YK36FvxUpsRn8OZhyeZrgwJFKniPHfB7pZfFB-B0MoaHmf4lulBg/exec', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: formBody
                });

                if (response.ok) {
                    showAlert('ØªÙ… Ø­Ø³Ø§Ø¨ Ø§Ù„ØªÙƒÙ„ÙØ© ÙˆØ­ÙØ¸ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­!');
                } else {
                    throw new Error('Network response was not ok');
                }
            } catch (error) {
                console.error('Error saving to Google Sheet:', error);
                showAlert('ØªÙ… Ø­Ø³Ø§Ø¨ Ø§Ù„ÙØ§ØªÙˆØ±Ø©ØŒ Ù„ÙƒÙ† Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø­ÙØ¸. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§ØªØµØ§Ù„ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª.');
            } finally {
                calculateBtn.disabled = false;
                calculateBtn.textContent = 'Ø­Ø³Ø§Ø¨ Ø§Ù„ØªÙƒÙ„ÙØ© ÙˆØ­ÙØ¸ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©';
            }
        });

        function populateInvoice(quantity, description, unitPrice, totalCost, paymentMethod) {
            const invoiceWrapper = document.getElementById('invoice-wrapper');
            
            document.getElementById('invoice-customer-phone').textContent = document.getElementById('customer-phone').value || 'Ø¹Ù…ÙŠÙ„ Ù†Ù‚Ø¯ÙŠ';
            document.getElementById('invoice-date').textContent = new Date().toLocaleDateString('ar-EG-u-nu-latn', { year: 'numeric', month: 'long', day: 'numeric' });
            document.getElementById('invoice-number').textContent = `INV-${Date.now().toString().slice(-7)}`;
            document.getElementById('invoice-payment-method').textContent = paymentMethod;
            
            document.getElementById('invoice-items').innerHTML = `
                <tr class="border-b border-gray-100">
                    <td class="p-3 font-medium">${description}</td>
                    <td class="p-3 text-center">${quantity}</td>
                    <td class="p-3 text-center">${unitPrice.toFixed(2)} Ø¬.Ù…</td>
                    <td class="p-3 text-left font-semibold">${totalCost.toFixed(2)} Ø¬.Ù…</td>
                </tr>
            `;
            
            document.getElementById('invoice-subtotal').textContent = `${totalCost.toFixed(2)} Ø¬.Ù…`;
            document.getElementById('invoice-total').textContent = `${totalCost.toFixed(2)} Ø¬.Ù…`;
            
            invoiceWrapper.classList.remove('hidden');
            invoiceWrapper.scrollIntoView({ behavior: 'smooth' });
        }

        document.getElementById('print-btn').addEventListener('click', () => {
            window.print();
        });
    });
    </script>
</body>
</html>